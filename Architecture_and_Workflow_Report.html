<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YakTech OPN Architecture Report</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            background: #f9f9f9;
        }

        .container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 0.5rem;
        }

        h2 {
            color: #34495e;
            margin-top: 2rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 0.3rem;
        }

        h3 {
            color: #7f8c8d;
            margin-top: 1.5rem;
        }

        code {
            background: #f0f0f0;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: monospace;
        }

        pre {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
        }

        .mermaid {
            margin: 2rem 0;
            text-align: center;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin: 1rem 0;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        .print-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            float: right;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .print-btn:hover {
            background: #2980b9;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
                padding: 0;
            }

            .print-btn {
                display: none;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <button onclick="window.print()" class="print-btn">üñ®Ô∏è Save as PDF</button>

        <h1>YakTech OPN Automation Architecture Report</h1>
        <p><em>Generated by Yakkay AI Agent | Version 2.0 (Consolidated)</em></p>

        <h2>1. System Overview</h2>
        <p>This document outlines the architecture of the YakTech Open Negotiation (OPN) Automation platform.
            As of <strong>January 2026</strong>, the system has been consolidated into a <strong>Unified Service
                Architecture</strong>, moving from a 3-service model to a streamlined 2-service model (Repi +
            OPN-Agent).</p>

        <h2>2. High-Level Architecture</h2>
        <p>The system consists of three primary components:</p>
        <ol>
            <li><strong>Frontend (UI):</strong> React-based user interface (`Port 3000`).</li>
            <li><strong>Repi (Unified Brain):</strong> Intelligent router and orchestrator (`Port 8001`).</li>
            <li><strong>OPN-Agent (Worker):</strong> Document execution engine (`Port 8000`).</li>
        </ol>

        <div class="mermaid">
            graph TB
            User[üë§ User / Browser] -->|1. Chat via UI| UI[üñ•Ô∏è Frontend UI<br />Port 3000]
            UI -->|2. Send Query| Repi[üß† Repi Service<br />(Router + Orchestrator)<br />Port 8001]

            subgraph "Repi (The Brain)"
            Repi <-->|Search| Qdrant[(Vector DB)]
                Repi <-->|Query| LLM[Grok LLM]
                    Repi <-->|Lookup| DB[(PostgreSQL)]
                        end

                        subgraph "Execution Layer"
                        Repi -->|3. Auto-Execute| OPN[‚öôÔ∏è OPN-Agent<br />Port 8000]
                        OPN -->|4. Generate| Docs[üìÑ Docs & Reports]
                        end

                        style UI fill:#3498db,stroke:#2980b9,color:#fff
                        style Repi fill:#e67e22,stroke:#d35400,color:#fff
                        style OPN fill:#2ecc71,stroke:#27ae60,color:#fff
        </div>

        <h2>3. End-to-End Workflow</h2>
        <p>The lifecycle of a user request in the unified architecture:</p>

        <div class="mermaid">
            sequenceDiagram
            participant U as üë§ User (UI)
            participant R as üß† Repi (8001)
            participant A as ‚öôÔ∏è OPN-Agent (8000)
            participant F as üìÅ File System

            Note over U,F: Step 1: Request Initiation
            U->>R: POST /process/process<br />"Create CEP Wave 6 docs"

            Note over U,F: Step 2: Intelligent Routing (Internal)
            R->>R: Analyze Intent (LLM) & Extract Params
            R->>R: Lookup Agent Endpoint in DB

            Note over U,F: Step 3: Orchestration (Internal)
            R->>R: Auto-resolve files (Excel, Template)
            R->>R: Construct Payload

            Note over U,F: Step 4: Execution
            R->>A: POST /run-advanced-workflow
            A->>A: Run Sub-Agents (Group, Notice, Merge)
            A->>F: Read Inputs & Write Outputs
            A-->>R: Return Results & Stats

            Note over U,F: Step 5: Completion
            R-->>U: Final Combined Results
            U->>U: Display "Task Completed"
        </div>

        <h2>4. Component Details</h2>

        <h3>üñ•Ô∏è Frontend UI (Port 3000)</h3>
        <ul>
            <li><strong>Tech Stack:</strong> React 19, Vite, Tailwind CSS, TypeScript.</li>
            <li><strong>Function:</strong> Real-time chat interface connected to Repi.</li>
        </ul>

        <h3>üß† Repi Service (Port 8001) - <em>Unified Brain</em></h3>
        <ul>
            <li><strong>Tech Stack:</strong> Python FastAPI, Supabase, Qdrant, Grok, HTTPX.</li>
            <li><strong>Roles:</strong>
                <ul>
                    <li><strong>Router:</strong> Intent analysis and agent selection.</li>
                    <li><strong>Orchestrator:</strong> Execution logic and file resolution.</li>
                    <li><strong>Registry:</strong> Central database of agent capabilities.</li>
                </ul>
            </li>
        </ul>

        <h3>‚öôÔ∏è OPN-Agent (Port 8000) - <em>The Worker</em></h3>
        <ul>
            <li><strong>Tech Stack:</strong> Python FastAPI, Semantic Kernel, Pandas.</li>
            <li><strong>Function:</strong> Multi-agent document generation worker.</li>
        </ul>

        <h2>5. Deployment Specs</h2>
        <table>
            <thead>
                <tr>
                    <th>Service</th>
                    <th>Port</th>
                    <th>URL</th>
                    <th>Role</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>UI</strong></td>
                    <td>3000</td>
                    <td>http://localhost:3000</td>
                    <td>User Interface</td>
                </tr>
                <tr>
                    <td><strong>Repi</strong></td>
                    <td>8001</td>
                    <td>http://localhost:8001</td>
                    <td><strong>Unified Brain</strong></td>
                </tr>
                <tr>
                    <td><strong>OPN-Agent</strong></td>
                    <td>8000</td>
                    <td>http://localhost:8000</td>
                    <td>Task Execution</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Mermaid JS -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</body>

</html>